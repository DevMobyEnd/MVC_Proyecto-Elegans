document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("selectImageBtn"),t=document.getElementById("Foto_PerfilInput"),i=document.getElementById("profilePreview"),n=document.getElementById("imageToCrop"),o=new bootstrap.Modal(document.getElementById("cropModal")),l=document.getElementById("cropImageBtn"),r=document.getElementById("croppedImageData"),a,s=null;function d(e){fetch(document.getElementById("registerForm").action,{method:"POST",body:e,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{"success"===e.status?Swal.fire({icon:"success",title:"\xc9xito",text:e.message}).then(()=>{window.location.href=e.redirect||"/"}):Swal.fire({icon:"error",title:"Error",text:e.message})}).catch(e=>{console.error("Error:",e),Swal.fire({icon:"error",title:"Error",text:"Hubo un problema al registrar el usuario. Por favor, intente nuevamente."})})}e.addEventListener("click",function(){t.click()}),t.addEventListener("change",function(e){!function e(t){if(t.files&&t.files[0]){s=t.files[0];let n=new FileReader;n.onload=function(e){i.src=e.target.result,i.style.display="block",r.value=""},n.readAsDataURL(t.files[0])}else i.src="./img/profile.jpg",i.style.display="block",s=null,r.value=""}(e.target)}),i.addEventListener("click",function(){"/Public/dist/img/profile.jpg"!==i.src&&(n.src=i.src,o.show(),a&&a.destroy(),a=new Cropper(n,{aspectRatio:1,viewMode:1,autoCropArea:1,minContainerWidth:600,minContainerHeight:600,zoomable:!0,scalable:!0,responsive:!0}),$("#cropModal").on("shown.bs.modal",function(){n.style.maxWidth="70%",n.style.maxHeight="70%",n.style.margin="auto"}))}),l.addEventListener("click",function(){if(a){let e=a.getCroppedCanvas({width:300,height:300,imageSmoothingEnabled:!0,imageSmoothingQuality:"high"});e.toBlob(function(t){let n=URL.createObjectURL(t);i.src=n,i.style.display="block",r.value=e.toDataURL("image/jpeg",1),o.hide()},"image/jpeg")}}),document.getElementById("cropModal").addEventListener("hidden.bs.modal",function(){a&&(a.destroy(),a=null)}),document.getElementById("registerForm").addEventListener("submit",function(e){e.preventDefault();let t=new FormData(this);r.value?fetch(r.value).then(e=>e.blob()).then(e=>{t.set("Foto_Perfil",e,"cropped_image.jpg"),d(t)}):s?(t.set("Foto_Perfil",s),d(t)):fetch("/Public/dist/img/profile.jpg").then(e=>e.blob()).then(e=>{t.set("Foto_Perfil",e,"default_profile.jpg"),d(t)})})});