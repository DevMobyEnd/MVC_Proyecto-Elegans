let croppedImageData=null;function handleImageCrop(e){croppedImageData=e}document.getElementById("registerButton").addEventListener("click",function(e){e.preventDefault();let t=validateStep2();if(t.length>0){Swal.fire({icon:"error",title:"Error",html:`<ul>${t.map(e=>`<li>${e}</li>`).join("")}</ul>`});return}let r=new FormData(document.getElementById("registerForm"));if(croppedImageData)r.set("croppedImageData",croppedImageData);else{let o=document.getElementById("Foto_PerfilInput");if(o.files.length>0)r.set("profilePicture",o.files[0]);else{Swal.fire({icon:"error",title:"Error",text:"Por favor, selecciona una imagen de perfil o recorta la imagen existente."});return}}fetch(document.getElementById("registerForm").action,{method:"POST",body:r,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{e.success?Swal.fire({icon:"success",title:"\xa1Registro exitoso!",text:"Tu cuenta ha sido creada correctamente."}).then(()=>{window.location.href=e.redirect}):Swal.fire({icon:"error",title:"Error",text:e.message})}).catch(e=>{console.error("Error:",e),Swal.fire({icon:"error",title:"Error",text:"Hubo un problema al registrar el usuario. Por favor, intente nuevamente."})})});