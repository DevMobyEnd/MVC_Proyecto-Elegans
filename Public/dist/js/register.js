function sanitizeInput(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}const WEAK_THRESHOLD=40,MODERATE_THRESHOLD=60,STRONG_THRESHOLD=80,debounce=(e,t)=>{let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>e.apply(null,r),t)}},validatePassword=e=>{let t=e.target.value,n=0,r=document.getElementById("password-strength"),o=document.getElementById("passwordHelp");t.length>=8&&(n+=20),t.match(/[a-z]+/)&&(n+=20),t.match(/[A-Z]+/)&&(n+=20),t.match(/[0-9]+/)&&(n+=20),t.match(/[$@#&!]+/)&&(n+=20),r.style.width=n+"%",r.setAttribute("aria-valuenow",n),n<40?(r.className="progress-bar bg-danger",o.textContent="Contrase\xf1a d\xe9bil"):n<60?(r.className="progress-bar bg-warning",o.textContent="Contrase\xf1a moderada"):n<80?(r.className="progress-bar bg-info",o.textContent="Contrase\xf1a fuerte"):(r.className="progress-bar bg-success",o.textContent="Contrase\xf1a muy fuerte")},debouncedValidatePassword=debounce(validatePassword,300);function onCaptchaSuccess(e){document.getElementById("cf-turnstile-response").value=e}function validateStep1(){let e=[],t=sanitizeInput(document.getElementById("nombresInput").value.trim()),n=sanitizeInput(document.getElementById("apellidosInput").value.trim()),r=sanitizeInput(document.getElementById("NumerodeDocumentoInput").value.trim()),o=sanitizeInput(document.getElementById("apodoInput").value.trim());return t||e.push("El nombre es requerido."),n||e.push("El apellido es requerido."),r||e.push("El n\xfamero de documento es requerido."),o||e.push("El apodo es requerido."),!(e.length>0)||(Swal.fire({icon:"error",title:"Campos requeridos",html:e.join("<br>"),confirmButtonText:"Entendido"}),!1)}function validateStep2(){let e=[],t=sanitizeInput(document.getElementById("emailInput").value),n=document.getElementById("passwordInput").value;return t||e.push("El correo electr\xf3nico es requerido."),n||e.push("La contrase\xf1a es requerida."),t&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)&&e.push("Por favor, ingrese un email v\xe1lido."),e}document.getElementById("passwordInput").addEventListener("input",debouncedValidatePassword),window.onload=function(){let e=document.querySelector(".cf-turnstile");e&&e.addEventListener("success",function(e){onCaptchaSuccess(e.detail.token)})},document.getElementById("nextStepBtn").addEventListener("click",function(e){e.preventDefault();let t=validateStep1();t.length>0?Swal.fire({icon:"error",title:"Campos requeridos",html:`<ul>${t.map(e=>`<li>${e}</li>`).join("")}</ul>`,confirmButtonText:"Entendido"}):showStep(2)});let croppedImageData=null;function handleImageCrop(e){croppedImageData=e}function previewImage(e){let t=document.getElementById("profilePreview");if(e.files&&e.files[0]){let n=new FileReader;n.onload=function(e){t.src=e.target.result,t.style.display="block"},n.readAsDataURL(e.files[0])}else t.src="/Public/dist/img/profile.jpg",t.style.display="none"}function openCropperModal(){$("#cropModal").modal("show")}function showStep(e){let t=document.querySelectorAll(".register-step");t.forEach(e=>{e.style.display="none"});let n=document.getElementById(`step${e}`);n&&(n.style.display="block")}document.getElementById("registerButton").addEventListener("click",function(e){e.preventDefault();let t=validateStep2();if(t.length>0){Swal.fire({icon:"error",title:"Error",html:`<ul>${t.map(e=>`<li>${e}</li>`).join("")}</ul>`});return}let n=new FormData(document.getElementById("registerForm")),r=document.getElementById("croppedImageData").value,o=document.getElementById("Foto_PerfilInput");r?n.set("croppedImageData",r):o.files.length>0&&n.set("Foto_Perfil",o.files[0]),n.append("Foto_Perfil",document.getElementById("Foto_PerfilInput").files[0]),n.set("Nombres",sanitizeInput(document.getElementById("nombresInput").value)),n.set("Apellidos",sanitizeInput(document.getElementById("apellidosInput").value)),n.set("NumerodeDocumento",sanitizeInput(document.getElementById("NumerodeDocumentoInput").value)),n.set("Apodo",sanitizeInput(document.getElementById("apodoInput").value)),n.set("CorreoElectronico",sanitizeInput(document.getElementById("emailInput").value)),n.append("cf-turnstile-response",document.getElementById("cf-turnstile-response").value),n.append("croppedImageData",document.getElementById("croppedImageData").value),console.log("Datos del formulario:",Object.fromEntries(n)),fetch(document.getElementById("registerForm").action,{method:"POST",body:n,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>(console.log("Respuesta del servidor:",e),e.text())).then(e=>{console.log("Resultado en texto:",e);try{return JSON.parse(e)}catch(t){throw console.error("Error al parsear JSON:",t),Error("Respuesta del servidor no es JSON v\xe1lido")}}).then(e=>{console.log("Resultado parseado:",e),"success"===e.status?Swal.fire({icon:"success",title:"\xc9xito",text:e.message}).then(()=>{window.location.href=e.redirect||"/"}):(console.error("Error del servidor:",e),Swal.fire({icon:"error",title:"Error",text:e.message,footer:e.debug?`Detalles de depuraci\xf3n: ${e.debug}`:""}))}).catch(e=>{console.error("Error en la solicitud:",e),Swal.fire({icon:"error",title:"Error",text:"Hubo un problema al registrar el usuario. Por favor, intente nuevamente.",footer:`Detalles del error: ${e.message}`})})}),document.getElementById("selectImageBtn").addEventListener("click",function(){document.getElementById("Foto_PerfilInput").click()}),document.getElementById("Foto_PerfilInput").addEventListener("change",function(){previewImage(this)}),showStep(1);